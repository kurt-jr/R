---
title: "stat6021week3"
author: "Kurt"
date: "2024-07-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
insurance <- read.csv("insurance.csv")
head(insurance)
```
```{r}
mod1 <- lm(charges~smoker, data = insurance)
summary(mod1)
```

```{r}
t.test(charges~smoker, data = insurance)
```
```{r}
new <-  data.frame(smoker='yes')
predict(mod1, new)
```
```{r}
mod2 <- lm(charges~region, data = insurance)
summary(mod2)
```
average insurance cost region northwest is the intercept, each estimate shows the difference between northwest and that region.


```{r}
insurance$region2 <- factor(insurance$region, levels = c("southeast","northeast", "northwest", "southwest"))
mod3 <- lm(charges~region2, data = insurance)
summary(mod3)
```
Anova:
H0: µne = µnw = µse = µsw
HA: At least one mean is different
```{r}
anov <- aov(charges~region, insurance)
summary(anov)
TukeyHSD(anov)
```


```{r}
ggplot(insurance, aes(age,charges, colour = smoker)) + geom_jitter() + geom_smooth(method = "lm", se = F, aes(group = smoker))
```
```{r}
mod4 <- lm(charges~ age+smoker, data = insurance)
summary(mod4)
```
intercept age = 0 cost = -2391.63
average  nonsmoker insurance cost increases by 274.87
average  smoker insurance cost increases by 23855.30
This is a **no-interaction model**
A regression model that includes a dummy variable for a categorical
predictor allows for different intercepts but not different slopes for the
two groups. This is called a **no-interaction model**, because it
assumes that the effect of the numerical predictor on the response is
the same for both groups



A more general model allows for different slopes as well as different
intercepts. An **interaction model** allows for the effect of a numerical
predictor to differ between the two/more groups.
* allows for interaction in lm function
```{r}
mod5int <- lm(charges~ age*smoker, data = insurance)
summary(mod5int)
```

as age increases by 1 the cost of insurance increases by 37.99
```{r}
new_dat<-data.frame(age=26, smoker="no")
predict(mod5int, new_dat, interval = "prediction")
```

```{r}
ins<-insurance[,-8]
mod10 <- lm(charges ~., data = ins)
summary(mod10)
```
```{r}
install.packages("broom")
library(broom)
dat_ins <- mod5int %>% augment(ins)
view(dat_ins)
filter(dat_ins, .std.resid>2)
```

Wednesday- outliers
treating outliers
Transform response
2 Consider context and subject matter knowledge
3 Measurement error?
4 Winsorize: Replace extreme values with the nearest values that are
not outliers. For example, replace values above the 95th percentile
with the value at the 95th percentile.
5 Trim/remove point (last resort)
6 Use other techniques like quantile regression or Random Forest which
are resistant to outliers

Leverage Points: data points that have extreme values for the predictor
variables. These points have a large influence on the fitted values of the
model but not necessarily on the regression coefficients themselves.
Detection:
1 Leverage values are in the diagonals of the Hat matrix: (XT X)−1XT
2 High leverage points are identified by leverage values greater than 2(p+1)/n


Influential points are data points that have a disproportionately large
impact on the regression model’s coefficients and fitted values.
1 NOTE: Data points that are both high leverage points and outliers
are often influential because their combination of having extreme
predictor values and large residuals gives them a significant impact on
the regression model
Detection: Cook’s Distance: a threshold of 4/n

```{r}
model1 <- lm(charges~., data = insurance)
summary(model1)
```
```{r}
diagnostics <- model1 %>%
  augment(data = insurance)
outliers <- filter(diagnostics, abs(.std.resid) >3)
leverage <- filter(diagnostics, .hat >2*(6+1)/nrow(insurance))
influence <- filter(diagnostics, .cooksd>4/nrow(insurance))
head(influence)
head(leverage)
```
.hat is leverage point


train-test split
```{r}
split <- sample(1:nrow(insurance), size = 0.8*nrow(insurance), )
```




